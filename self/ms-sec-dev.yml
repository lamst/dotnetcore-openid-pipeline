# File ms-sec-dev.yml

# The scan type to use for the AntiMalware scan.
parameters:
- name: antimalwareScanType
  type: string
  default: 'QuickScan'
  values:
  - 'CustomScan'
  - 'FullSystemScan'
  - 'QuickScan'
  - 'YourConfigurationScan'
# Basic builds the commandline for you based on other inputs; 
# CommandLine requires that you provide the exact commandline that you would use to run binskim.exe manually
- name: binSkimInputType
  type: string
  default: 'Basic'
  values:
  - 'Basic'
  - 'CommandLine'
# Standard Binskim command line arguments to execute. The output path will be removed and replaced.
- name: binSkimArguments
  type: string
  default: ''
# One or more specifiers to a file, directory, or filter pattern that resolves to one or more binaries to analyze. (';' separated list)
- name: binSkimAnalyzeTarget
  type: string
  default: ''
# Recurse into subdirectories when evaluating file specifier arguments.
- name: binSkimAnalyzeRecurse
  type: boolean
  default: true
# Emit verbose output. The resulting comprehensive report is designed to provide appropriate evidence for compliance scenarios.
- name: binSkimAnalyzeVerbose
  type: boolean
  default: false
# The version of the tool to run.
- name: credScanToolVersion
  type: string
  default: 'Latest'
  values:
  - '1.27.7'
  - 'Latest'
  - 'LatestPreRelease'
# The folder in your repository to scan for credentials.
- name: credScanFolder
  type: string
  default: ''

steps:
  - task: securedevelopmentteam.vss-secure-development-tools.build-task-antimalware.AntiMalware@3
    displayName: "Run Windows Defender AntiMalware Scan"
    condition: always()
    inputs:
      scanType: ${{ parameters.antimalwareScanType }}
  
  - task: securedevelopmentteam.vss-secure-development-tools.build-task-binskim.BinSkim@3
    displayName: 'Run BinSkim'
    condition: always()
    inputs:
      InputType: ${{ parameters.binSkimInputType }}
      ${{ if eq(parameters.binSkimInputType, 'CommandLine') }}:
        arguments: ${{ parameters.binSkimArguments }}
      ${{ if eq(parameters.binSkimAnalyzeVerbose, true) }}:
        analyzeVerbose: ${{ parameters.binSkimAnalyzeVerbose }}
      ${{ if gt(length(parameters.binSkimAnalyzeTarget), 0) }}:
        analyzeTarget: ${{ parameters.binSkimAnalyzeTarget }}
      analyzeRecurse: ${{ parameters.binSkimAnalyzeRecurse }}
  
  - task: securedevelopmentteam.vss-secure-development-tools.build-task-credscan.CredScan@2
    displayName: 'Run CredScan'
    inputs:
      toolMajorVersion: V2
      debugMode: false
      toolVersion: ${{ parameters.credScanToolVersion }}
      ${{ if gt(length(parameters.credScanFolder), 0) }}:
        scanFolder: ${{ parameters.credScanFolder }}
      

